#!/usr/bin/env bash

# Script install development environment when build i2s image

# Quick error exit from script when fail any command below
set -e

BUILD_TIME_ENABLE_DEV=${BUILD_TIME_ENABLE_DEV:-false}

# Exit is run on production environment
if [[ "$BUILD_TIME_ENABLE_DEV" != true ]] ; then
    echo 'Is release build'
    exit 0
fi

# Install shell check https://www.mankier.com/1/shellcheck
yum install -y --setopt=tsflags=nodocs ShellCheck
shellcheck -v

# Install php ast extension for phan https://github.com/nikic/php-ast
yum install -y --setopt=tsflags=nodocs php-ast
php -r 'function_exists("ast\parse_code") || (print("Failed to enable php-ast\n") && exit(1));'

# Install symfony cli https://symfony.com/download
mkdir /tmp/symfony
curl -L -o /tmp/symfony/symfony-setup https://get.symfony.com/cli/installer
bash /tmp/symfony/symfony-setup
mv ~/.symfony/bin/symfony /usr/local/bin/symfony
symfony -V
rm -rf /tmp/symfony
